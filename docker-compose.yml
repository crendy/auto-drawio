version: '3.8'

services:
  auto-drawio:
    build:
      context: .
      dockerfile: Dockerfile
      # 强制重新构建（开发环境可取消注释）
      # no_cache: true
    container_name: auto-drawio
    restart: unless-stopped

    # 端口映射（主机端口:容器端口）
    ports:
      - "8000:8000"  # 默认 8000 端口，可修改为 "80:8000" 使用 80 端口

    # 环境变量配置（可选，也可在前端界面配置）
    environment:
      - DEV_MODE=false
      # - DEFAULT_AI_NAME=Claude Sonnet 4.5
      # - DEFAULT_AI_BASE_URL=https://api.example.com/v1
      # - DEFAULT_AI_API_KEY=your-api-key-here
      # - DEFAULT_AI_MODEL=claude-sonnet-4-5-20250929

    # 使用 .env 文件加载环境变量（推荐）
    env_file:
      - ./backend/.env

    # 数据卷挂载（如果需要持久化数据）
    # volumes:
    #   - ./data:/app/data

    # 健康检查
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # 网络配置
    networks:
      - auto-drawio-network

networks:
  auto-drawio-network:
    driver: bridge
